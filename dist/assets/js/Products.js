import{I as j,d as p,o as O,g as i,a as r,c,b as e,A as V,G as M,F as w,k as F,t as _,j as A,u as z,m as G,e as K,f as C,w as q,i as J,B as u,D as v,h as E,K as Q,l as $}from"./index.js";import{_ as W}from"./Navbar.js";import{e as g}from"./EventBus.js";import{M as H}from"./bootstrap.esm.js";import{$ as X}from"./jquery.js";const Y={key:0,"aria-label":"Page navigation",class:"rol"},Z={class:"pagination"},ee=e("span",{"aria-hidden":"true"},"«",-1),te=[ee],oe=["onClick"],le=e("a",{class:"page-link",href:"#","aria-label":"Next"},[e("span",{"aria-hidden":"true"},"»")],-1),ae=[le],se={__name:"Pagination",setup(L){j();let s=p(null);function m(f){g.emit("pagination:chage",f),console.log(f)}return O(()=>{g.on("pagination:init",f=>{s.value=f})}),(f,b)=>i(s)&&i(s).total_pages>0?(r(),c("nav",Y,[e("ul",Z,[e("li",{class:V(["page-item",{disabled:!i(s).has_pre}])},[e("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:b[0]||(b[0]=M(l=>m(i(s).current_page-1),["prevent"]))},te)],2),(r(!0),c(w,null,F(i(s).total_pages,l=>(r(),c("li",{class:V(["page-item",{active:i(s).current_page===l}])},[e("a",{class:"page-link",href:"#",onClick:M(x=>m(l),["prevent"])},_(l),9,oe)],2))),256)),e("li",{class:V(["page-item",{disabled:!i(s).has_next}]),onClick:b[1]||(b[1]=M(l=>m(i(s).current_page+1),["prevent"]))},ae,2)])])):A("",!0)}};var d={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ne={class:"nav-item"},ie={class:"p-3 pt-0"},de={class:"table table-striped"},re=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"庫存"),e("th",{scope:"col"},"單位"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"活動價"),e("th",{scope:"col"},"狀態"),e("th",{scope:"col"},"管理")])],-1),ce={scope:"row"},ue={key:0},pe={key:1},_e=["onClick"],me={class:"modal-dialog modal-lg",role:"document"},fe={class:"modal-content border-0"},he={class:"modal-header bg-dark text-white"},ve={class:"modal-title",id:"exampleModalLabel"},ge=e("button",{type:"button",class:"btn-close text-light","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),be={class:"modal-body"},ye={class:"row"},Ue={class:"col-sm-4"},ke={class:"form-group"},$e=e("label",{for:"image"},"輸入圖片網址",-1),Me={class:"form-group"},xe={for:"customFile"},Te={key:0,class:"fas fa-spinner fa-spin"},Pe={key:1,class:"fa-solid fa-triangle-exclamation"},Ve=["src"],Ce={class:"col-sm-8"},Ee={class:"form-group"},we=e("label",{for:"title"},"標題",-1),Ae={class:"form-row"},Ie={class:"form-group col-md-6"},Se=e("label",{for:"category"},"分類",-1),De={class:"form-group col-md-6"},He=e("label",{for:"price"},"單位",-1),Oe={class:"form-row"},Fe={class:"form-group col-md-6"},Le=e("label",{for:"origin_price"},"原價",-1),Be={class:"form-group col-md-6"},Ne=e("label",{for:"price"},"售價",-1),Re=e("hr",null,null,-1),je={class:"form-group"},ze=e("label",{for:"description"},"產品描述",-1),Ge={class:"form-group"},Ke=e("label",{for:"content"},"說明內容",-1),qe={class:"form-group"},Je={class:"form-check"},Qe=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),We=e("button",{type:"button",class:"btn btn-danger me-auto","data-bs-toggle":"modal","data-bs-target":"#delProductModal"}," 刪除 ",-1),Xe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),Ye={class:"modal-dialog",role:"document"},Ze={class:"modal-content border-0"},et=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"刪除產品")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),tt={class:"modal-body"},ot={class:"text-danger"},lt=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),ct={__name:"Products",setup(L){window.$=X;const s=z(),m=p(!1),f=p([]),b=p(),l=p({}),x=p(null),I=p(null);let k=null,T=null,y=p(!1),h=p({fileUploading:!1,fileUploadError:!1});function U(a=1){y.value=!0;const t=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/products?page=${a}`;$.get(t).then(n=>{n.data.success?(y.value=!1,f.value=n.data.products,b.value=n.data.pagination,g.emit("pagination:init",b.value)):(g.emit("messagepush","需登入","warning"),s.replace("/"))})}function B(){let a=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/product`,t="post";m.value||(a=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/product/${l.value.id}`,t="put"),$[t](a,{data:l.value}).then(n=>{n.data.success?(k.hide(),U()):(k.hide(),U(),g.emit("messagepush","新增產品失敗","warning"))})}function S(a,t){h.value.fileUploadError&&(h.value.fileUploadError=!1),a?(l.value={},m.value=!0):(l.value=Object.assign({},t),m.value=!1),k.show()}function N(){let a=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/product/${l.value.id}`;$["delete"](a).then(n=>{n.data.success?(T.hide(),U()):(T.hide(),U(),g.emit("messagepush","刪除產品失敗","warning"))})}function R(a){const t=a.target,n=t.files[0];if(t&&t.files){h.value.fileUploading=!0;const o=new FormData;o.append("file-to-upload",n);const D=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/upload`;$["post"](D,o,{headers:{"Content-Type":"multipart/form-data"}}).then(P=>{P.data.success?(h.value.fileUploading=!1,l.value.imageUrl=P.data.imageUrl):(h.value.fileUploading=!1,h.value.fileUploadError=!0,g.emit("message:push",P.data.message,"warning"))})}}return O(()=>{k=new H(x.value),T=new H(I.value)}),G(()=>{U(),g.on("pagination:chage",a=>{U(a)})}),(a,t)=>{const n=K("loading");return r(),c(w,null,[C(W,null,{default:q(()=>[e("li",ne,[e("a",{class:"nav-link text-success",href:"#",onClick:t[0]||(t[0]=M(o=>S(!0),["prevent"]))}," 建立新產品 ")])]),_:1}),C(n,{active:i(y),"onUpdate:active":t[1]||(t[1]=o=>J(y)?y.value=o:y=o)},null,8,["active"]),e("div",ie,[e("table",de,[re,e("tbody",null,[(r(!0),c(w,null,F(f.value,o=>(r(),c("tr",{key:o.id},[e("th",ce,_(o.category),1),e("td",null,_(o.title),1),e("td",null,_(o.num),1),e("td",null,_(o.unit),1),e("td",null,_(a.$currency.currencyUSD(o.origin_price)),1),e("td",null,_(a.$currency.currencyUSD(o.price)),1),e("td",null,[o.is_enabled?(r(),c("span",ue,"啟用")):(r(),c("span",pe,"未啟用"))]),e("td",null,[e("button",{onClick:D=>S(!1,o)},"修改或刪除",8,_e)])]))),128))])]),C(se),e("div",{ref_key:"modalEle_product",ref:x,class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",me,[e("div",fe,[e("div",he,[e("h5",ve,[e("span",null,_(m.value?"新增產品":"編輯產品"),1)]),ge]),e("div",be,[e("div",ye,[e("div",Ue,[e("div",ke,[$e,u(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.imageUrl=o),placeholder:"請輸入圖片連結"},null,512),[[v,l.value.imageUrl]])]),e("div",Me,[e("label",xe,[E("或 上傳圖片 "),i(h).fileUploading?(r(),c("i",Te)):A("",!0),i(h).fileUploadError?(r(),c("i",Pe)):A("",!0)]),e("input",{type:"file",id:"customFile",class:"form-control",onChange:t[3]||(t[3]=o=>R(o))},null,32)]),e("img",{src:l.value.imageUrl,class:"img-fluid",alt:""},null,8,Ve)]),e("div",Ce,[e("div",Ee,[we,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[4]||(t[4]=o=>l.value.title=o),placeholder:"請輸入標題"},null,512),[[v,l.value.title]])]),e("div",Ae,[e("div",Ie,[Se,u(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":t[5]||(t[5]=o=>l.value.category=o),placeholder:"請輸入分類"},null,512),[[v,l.value.category]])]),e("div",De,[He,u(e("input",{type:"unit",class:"form-control",id:"unit","onUpdate:modelValue":t[6]||(t[6]=o=>l.value.unit=o),placeholder:"請輸入單位"},null,512),[[v,l.value.unit]])])]),e("div",Oe,[e("div",Fe,[Le,u(e("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":t[7]||(t[7]=o=>l.value.origin_price=o),placeholder:"請輸入原價"},null,512),[[v,l.value.origin_price]])]),e("div",Be,[Ne,u(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[8]||(t[8]=o=>l.value.price=o),placeholder:"請輸入售價"},null,512),[[v,l.value.price]])])]),Re,e("div",je,[ze,u(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":t[9]||(t[9]=o=>l.value.description=o),placeholder:"請輸入產品描述"},null,512),[[v,l.value.description]])]),e("div",Ge,[Ke,u(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":t[10]||(t[10]=o=>l.value.content=o),placeholder:"請輸入產品說明內容"},null,512),[[v,l.value.content]])]),e("div",qe,[e("div",Je,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=o=>l.value.is_enabled=o),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[Q,l.value.is_enabled]]),Qe])])])])]),e("div",{class:"modal-footer"},[We,Xe,e("button",{id:"productModal_btn",type:"button",class:"btn btn-primary",onClick:B},"確認")])])])],512),e("div",{ref_key:"modalEle_del",ref:I,class:"modal fade",id:"delProductModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",Ye,[e("div",Ze,[et,e("div",tt,[E(" 是否刪除 "),e("strong",ot,_(l.value.title),1),E(" 商品(刪除後將無法恢復)。 ")]),e("div",{class:"modal-footer"},[lt,e("button",{type:"button",class:"btn btn-danger",onClick:N},"確認刪除")])])])],512)])],64)}}};export{ct as default};
