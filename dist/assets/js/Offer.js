import{u as $,d as n,o as I,m as O,a as i,c,f as H,w as S,b as e,F as U,k as B,t as r,B as m,D as v,K as D,g as V,j as E,h as b,l as g,G as L}from"./index.js";import{e as h}from"./EventBus.js";import{M as P}from"./bootstrap.esm.js";import{_ as N}from"./Navbar.js";var d={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const j={class:"nav-item"},R={class:"table table-striped"},F=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠折數"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"是否啟用")])],-1),G={key:0},K={key:1},q=["onClick"],z={class:"modal-dialog modal-lg",role:"document"},J={class:"modal-content border-0"},Q={class:"modal-header bg-dark text-white"},W={class:"modal-title",id:"exampleModalLabel"},X=e("button",{type:"button",class:"btn-close text-light","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},Z={class:"row"},ee={class:"col-sm-8"},te={class:"form-group"},ae=e("label",{for:"title"},"標題",-1),oe={class:"form-row"},le={class:"form-group col-md-6"},se=e("label",{for:"percent"},"優惠折數",-1),de={class:"form-group col-md-6"},ne=e("label",{for:"code"},"優惠碼",-1),ie={class:"form-group"},ce={class:"form-check"},ue=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),re={class:"modal-footer"},pe=e("button",{type:"button",class:"btn btn-danger me-auto","data-bs-toggle":"modal","data-bs-target":"#delProductModal"}," 刪除 ",-1),_e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),me={key:0,class:"fas fa-spinner fa-spin"},be={class:"modal-dialog",role:"document"},he={class:"modal-content border-0"},fe=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"刪除產品")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ve={class:"modal-body"},ge={class:"text-danger"},ye={class:"modal-footer"},Me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),ke={key:0,class:"fas fa-spinner fa-spin"},Ce={__name:"Offer",setup(Te){const C=$(),y=n([]),o=n({}),M=n(),p=n(!1),k=n(null),T=n(null);let _=null,f=null,s=n({dataUploading:!1});function u(){const l=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/coupons`;g.get(l).then(t=>{console.log(t.data),t.data.success?(y.value=t.data.coupons,M.value=t.data.pagination,h.emit("pagination:init",M.value)):(console.log("未登入"),C.replace("/"))})}function x(l,t){l?(o.value={},p.value=!0):(o.value=Object.assign({},t),p.value=!1),_.show()}function w(){s.value.dataUploading=!0;let l=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/coupon`,t="post";p.value||(l=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/coupon/${o.value.id}`,t="put"),g[t](l,{data:o.value}).then(a=>{a.data.success?(s.value.dataUploading=!1,_.hide(),u()):(s.value.dataUploading=!1,_.hide(),u(),h.emit("messagepush","新增優惠券失敗","warning"))})}function A(){s.value.dataUploading=!0;let l=`${d.VITE_APIPATH}/api/${d.VITE_CUSTOMPATH}/admin/coupon/${o.value.id}`;g["delete"](l).then(a=>{a.data.success?(s.value.dataUploading=!1,f.hide(),u()):(s.value.dataUploading=!1,f.hide(),u(),h.emit("messagepush","刪除優惠券失敗","warning"))})}return I(()=>{_=new P(k.value),f=new P(T.value)}),O(()=>{u(),h.on("pagination:chage",l=>{u()})}),(l,t)=>(i(),c(U,null,[H(N,null,{default:S(()=>[e("li",j,[e("a",{class:"nav-link text-success",href:"#",onClick:t[0]||(t[0]=L(a=>x(!0),["prevent"]))}," 建立優惠券 ")])]),_:1}),e("div",null,[e("table",R,[F,e("tbody",null,[(i(!0),c(U,null,B(y.value,a=>(i(),c("tr",{key:a.due_date},[e("td",null,r(a.title),1),e("td",null,r(a.percent),1),e("td",null,r(a.code),1),e("td",null,[a.is_enabled?(i(),c("span",G,"啟用")):(i(),c("span",K,"未啟用"))]),e("td",null,[e("button",{onClick:xe=>x(!1,a)},"修改或刪除",8,q)])]))),128))])]),e("div",{ref_key:"modalEle_coupon",ref:k,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",z,[e("div",J,[e("div",Q,[e("h5",W,[e("span",null,r(p.value?"新增優惠券":"編輯優惠券"),1)]),X]),e("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[ae,m(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.title=a),placeholder:"請輸入標題"},null,512),[[v,o.value.title]])]),e("div",oe,[e("div",le,[se,m(e("input",{type:"text",class:"form-control",id:"percent","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.percent=a),placeholder:"請輸入優惠折數"},null,512),[[v,o.value.percent,void 0,{number:!0}]])]),e("div",de,[ne,m(e("input",{type:"unit",class:"form-control",id:"code","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.code=a),placeholder:"請輸入優惠碼"},null,512),[[v,o.value.code]])])]),e("div",ie,[e("div",ce,[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.is_enabled=a),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[D,o.value.is_enabled]]),ue])])])])]),e("div",re,[pe,_e,e("button",{id:"couponModal_btn",type:"button",class:"btn btn-primary",onClick:w},[V(s).dataUploading?(i(),c("i",me)):E("",!0),b(" 確認 ")])])])])],512),e("div",{ref_key:"modalEle_del",ref:T,class:"modal fade",id:"delProductModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",be,[e("div",he,[fe,e("div",ve,[b(" 是否刪除 "),e("strong",ge,r(o.value.title),1),b(" 商品(刪除後將無法恢復)。 ")]),e("div",ye,[Me,e("button",{type:"button",class:"btn btn-danger",onClick:A},[V(s).dataUploading?(i(),c("i",ke)):E("",!0),b(" 確認刪除 ")])])])])],512)])],64))}};export{Ce as default};
