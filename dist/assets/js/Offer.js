import{u as L,r as d,o as N,m as O,a as n,c as i,h as j,w as z,b as e,F as w,k as D,t as u,B as _,D as v,K as P,d as U,j as $,f as h,l as f,G as F}from"./index.js";import{e as m}from"./EventBus.js";import{M as C}from"./bootstrap.esm.js";import{_ as T}from"./Navbar.js";const G={class:"nav-item"},K={class:"table table-striped"},R=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠折數"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"是否啟用")])],-1),S={key:0},q={key:1},A=["onClick"],H={class:"modal-dialog modal-lg",role:"document"},I={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},Q={class:"modal-title",id:"exampleModalLabel"},W=e("button",{type:"button",class:"btn-close text-light","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-sm-8"},ee={class:"form-group"},te=e("label",{for:"title"},"標題",-1),oe={class:"form-row"},ae={class:"form-group col-md-6"},le=e("label",{for:"percent"},"優惠折數",-1),se={class:"form-group col-md-6"},de=e("label",{for:"code"},"優惠碼",-1),ne={class:"form-group"},ie={class:"form-check"},ce=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ue={class:"modal-footer"},re=e("button",{type:"button",class:"btn btn-danger me-auto","data-bs-toggle":"modal","data-bs-target":"#delProductModal"}," 刪除 ",-1),pe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),_e={key:0,class:"fas fa-spinner fa-spin"},he={class:"modal-dialog",role:"document"},me={class:"modal-content border-0"},be=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"刪除產品")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ve={class:"modal-body"},fe={class:"text-danger"},ge={class:"modal-footer"},ye=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),xe={key:0,class:"fas fa-spinner fa-spin"},Ve={__name:"Offer",setup(ke){const V=L(),g=d([]),a=d({}),y=d(),r=d(!1),x=d(null),k=d(null);let p=null,b=null,s=d({dataUploading:!1});function c(){f.get("https://vue-course-api.hexschool.io/api/ozeu/admin/coupons").then(t=>{console.log(t.data),t.data.success?(g.value=t.data.coupons,y.value=t.data.pagination,m.emit("pagination:init",y.value)):(console.log("未登入"),V.replace("/"))})}function M(l,t){l?(a.value={},r.value=!0):(a.value=Object.assign({},t),r.value=!1),p.show()}function B(){s.value.dataUploading=!0;let l="https://vue-course-api.hexschool.io/api/ozeu/admin/coupon",t="post";r.value||(l=`https://vue-course-api.hexschool.io/api/ozeu/admin/coupon/${a.value.id}`,t="put"),f[t](l,{data:a.value}).then(o=>{o.data.success?(s.value.dataUploading=!1,p.hide(),c()):(s.value.dataUploading=!1,p.hide(),c(),m.emit("messagepush","新增優惠券失敗","warning"))})}function E(){s.value.dataUploading=!0;let l=`https://vue-course-api.hexschool.io/api/ozeu/admin/coupon/${a.value.id}`;f["delete"](l).then(o=>{o.data.success?(s.value.dataUploading=!1,b.hide(),c()):(s.value.dataUploading=!1,b.hide(),c(),m.emit("messagepush","刪除優惠券失敗","warning"))})}return N(()=>{p=new C(x.value),b=new C(k.value)}),O(()=>{c(),m.on("pagination:chage",l=>{c()})}),(l,t)=>(n(),i(w,null,[j(T,null,{default:z(()=>[e("li",G,[e("a",{class:"nav-link text-success",href:"#",onClick:t[0]||(t[0]=F(o=>M(!0),["prevent"]))}," 建立優惠券 ")])]),_:1}),e("div",null,[e("table",K,[R,e("tbody",null,[(n(!0),i(w,null,D(g.value,o=>(n(),i("tr",{key:o.due_date},[e("td",null,u(o.title),1),e("td",null,u(o.percent),1),e("td",null,u(o.code),1),e("td",null,[o.is_enabled?(n(),i("span",S,"啟用")):(n(),i("span",q,"未啟用"))]),e("td",null,[e("button",{onClick:Me=>M(!1,o)},"修改或刪除",8,A)])]))),128))])]),e("div",{ref_key:"modalEle_coupon",ref:x,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",H,[e("div",I,[e("div",J,[e("h5",Q,[e("span",null,u(r.value?"新增優惠券":"編輯優惠券"),1)]),W]),e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[te,_(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.title=o),placeholder:"請輸入標題"},null,512),[[v,a.value.title]])]),e("div",oe,[e("div",ae,[le,_(e("input",{type:"text",class:"form-control",id:"percent","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.percent=o),placeholder:"請輸入優惠折數"},null,512),[[v,a.value.percent,void 0,{number:!0}]])]),e("div",se,[de,_(e("input",{type:"unit",class:"form-control",id:"code","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.code=o),placeholder:"請輸入優惠碼"},null,512),[[v,a.value.code]])])]),e("div",ne,[e("div",ie,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=o=>a.value.is_enabled=o),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[P,a.value.is_enabled]]),ce])])])])]),e("div",ue,[re,pe,e("button",{id:"couponModal_btn",type:"button",class:"btn btn-primary",onClick:B},[U(s).dataUploading?(n(),i("i",_e)):$("",!0),h(" 確認 ")])])])])],512),e("div",{ref_key:"modalEle_del",ref:k,class:"modal fade",id:"delProductModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",he,[e("div",me,[be,e("div",ve,[h(" 是否刪除 "),e("strong",fe,u(a.value.title),1),h(" 商品(刪除後將無法恢復)。 ")]),e("div",ge,[ye,e("button",{type:"button",class:"btn btn-danger",onClick:E},[U(s).dataUploading?(n(),i("i",xe)):$("",!0),h(" 確認刪除 ")])])])])],512)])],64))}};export{Ve as default};
