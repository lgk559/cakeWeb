import{u as N,d as r,o as z,m as G,e as k,a as u,c as _,b as e,f as p,g as h,i as J,F as $,k as w,t as a,j as x,B as A,D,w as K,h as f,M as Q,l as b,H as W}from"./index.js";import{e as I}from"./EventBus.js";import{M as X}from"./bootstrap.esm.js";import{$ as Y}from"./jquery.js";import{_ as Z}from"./Pagination.js";var n={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ee={class:"row m-4"},te={class:"card border-1 shadow-sm"},se={class:"card-body"},oe={class:"badge badge-secondary float-right ml-2"},ae={class:"card-title"},le={href:"#",class:"text-dark"},ne={class:"card-text"},de={class:"d-flex justify-content-between align-items-baseline"},ce={class:"h6"},ie={class:"h5"},re={class:"card-footer d-flex"},ue=["onClick","disabled"],_e={key:0,class:"fas fa-spinner fa-spin"},pe=["disabled","onClick"],me={key:0,class:"fas fa-spinner fa-spin"},he={class:"row"},ve={class:"col-12"},fe={class:"table table-striped"},be=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"管理"),e("th",{scope:"col"},"#"),e("th",{scope:"col flex-grow-1"},"品名"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"單價"),e("th",{scope:"col"},"小計")])],-1),ge=["id"],ye={scope:"col"},Te=["onClick"],xe={key:0,class:"fas fa-spinner fa-spin"},Ce={scope:"col"},Ve={scope:"col flex-grow-1"},ke={scope:"col"},$e={scope:"col"},Ee={scope:"col"},Pe=e("td",{colspan:"4",class:"text-right"},null,-1),we=e("td",{class:"text-left"},"總計",-1),Ae={class:"text-left"},Ie={key:0},Me=e("td",{colspan:"4",class:"text-right"},null,-1),Ue=e("td",{class:"text-left text-success"},"折扣價",-1),Se={class:"text-left text-success"},He={class:"row"},Oe={class:"col-8 m-auto d-flex mb-3"},Le=e("span",{class:"input-group-text rounded-0 rounded-start",id:"basic-addon3"},"使用優換券",-1),De={class:"my-5 row justify-content-center"},qe={class:"form-group"},Be=e("label",{for:"useremail"},"Email",-1),Fe={class:"form-group"},je=e("label",{for:"username"},"收件人姓名",-1),Re={class:"form-group"},Ne=e("label",{for:"usertel"},"收件人電話",-1),ze={class:"form-group"},Ge=e("label",{for:"useraddress"},"收件人地址",-1),Je={class:"form-group"},Ke=e("label",{for:"comment"},"留言",-1),Qe=e("div",{class:"text-right"},[e("button",{class:"btn btn-danger"},"送出訂單")],-1),We={class:"modal-dialog modal-lg",role:"document"},Xe={class:"modal-content border-0"},Ye={class:"modal-header bg-dark text-white"},Ze={class:"modal-title fs-5",id:"exampleModalLabel"},et=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),tt={class:"modal-body"},st={class:"row"},ot={class:"col-12 mb-3"},at=["src"],lt={class:"col-12 mb-3 text-break"},nt=e("p",null,"商品描述：",-1),dt=e("hr",null,null,-1),ct={class:"col-12 mb-3 text-break"},it=e("p",null,"商品內容：",-1),rt=e("hr",null,null,-1),ut={class:"col-6 mb-3 text-decoration-line-through text-secondary"},_t=e("span",null,"原價：",-1),pt={class:"text-decoration-line-through"},mt={class:"col-6 mb-3 text-danger"},ht=e("span",null,"特價：",-1),vt={class:"fs-5"},ft={class:"col-12 mb-3"},bt={class:"form-row"},gt={class:"form-group col-12"},yt=e("label",{for:"select-num",class:"form-label mb-1"},"購買數量：",-1),Tt=e("option",{value:"0",selected:"",disabled:""},"請選擇",-1),xt=["value"],Ct={class:"modal-footer d-flex justify-content-between"},Vt=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),kt={class:"col-auto d-flex align-items-center text-break"},$t={class:"me-3"},Et=e("span",null,"小計：",-1),Pt={key:0,class:"fas fa-spinner fa-spin"},Ot={__name:"CustomerOrder",setup(wt){window.$=Y,N();const M=r([]),d=r({}),U=r(),g=r([]),C=r(0),y=r(""),c=r({user:{name:"",email:"",tel:"",address:""},message:""});let m=r(!1),l=r({productLoading:"",productChangeToCart:""}),S=r(null),E=null,H=r(null);function O(){const o=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/products`;m.value=!0,b.get(o).then(s=>{s.data.success&&(m.value=!1,M.value=s.data.products,U.value=s.data.pagination,I.emit("pagination:init",U.value))})}function q(o){const s=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/product/${o}`;l.value.productLoading=o,b.get(s).then(i=>{i.data.success&&(d.value=i.data.product,E.show(),l.value.productLoading="")})}function L(o,s=1){const i=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/cart`;l.value.productChangeToCart=o,console.log(o,s),b.post(i,{data:{product_id:o,qty:s}}).then(v=>{console.log(v.data),v.data.success&&(l.value.productChangeToCart="",E.hide(),T())})}function T(){const o=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/cart`;b.get(o).then(s=>{s.data.success&&(g.value=s.data.data)})}function B(){m.value=!0;const o=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/coupon`;b.post(o,{data:{code:y.value}}).then(s=>{s.data.success?(T(),m.value=!1,y.value=""):(m.value=!1,y.value="",I.emit("message:push",s.data.message,"warning"))})}function F(o){d.value=o;const s=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/cart/${o.id}`;l.value.productChangeToCart=o.id,b.delete(s).then(i=>{console.log(i.data),i.data.success&&(l.value.productChangeToCart="",T())})}function j(o){if(o){const s=`${n.VITE_APIPATH}/api/${n.VITE_CUSTOMPATH}/order`;b.post(s,{data:c.value}).then(i=>{console.log(i.data),i.data.success&&(T(),c.value={})})}else console.log("this field is required")}return z(()=>{E=new X(S.value),console.log(H.value.validate)}),G(()=>{O(),T(),I.on("pagination:chage",o=>{O()})}),(o,s)=>{const i=k("loading"),v=k("VField"),V=k("ErrorMessage"),R=k("VForm");return u(),_($,null,[e("div",null,[p(i,{active:h(m),"onUpdate:active":s[0]||(s[0]=t=>J(m)?m.value=t:m=t)},null,8,["active"]),e("div",ee,[(u(!0),_($,null,w(M.value,t=>(u(),_("div",{class:"col-md-4 mb-4",key:t.id},[e("div",te,[e("div",{class:"rounded-top",style:W([{height:"150px","background-size":"cover","background-position":"center"},{"background-image":`url(${t.imageUrl})`}])},null,4),e("div",se,[e("span",oe,a(t.category),1),e("h5",ae,[e("a",le,a(t.title),1)]),e("p",ne,a(t.content),1),e("div",de,[e("del",ce,"原價 "+a(t.origin_price)+" 元",1),e("div",ie,"現在只要 "+a(t.price)+" 元",1)])]),e("div",re,[e("button",{type:"button",class:"btn btn-outline-secondary btn-sm me-3",onClick:P=>q(t.id),disabled:h(l).productChangeToCart||h(l).productLoading==t.id},[h(l).productLoading==t.id?(u(),_("i",_e)):x("",!0),f(" 查看更多 ")],8,ue),e("button",{type:"button",class:"btn btn-outline-danger btn-sm ml-auto",disabled:h(l).productChangeToCart||h(l).productLoading==t.id,onClick:P=>L(t.id)},[h(l).productChangeToCart==t.id?(u(),_("i",me)):x("",!0),f(" 加到購物車 ")],8,pe)])])]))),128)),p(Z),e("div",he,[e("div",ve,[e("table",fe,[be,e("tbody",null,[(u(!0),_($,null,w(g.value.carts,(t,P)=>(u(),_("tr",{key:t.id,id:t.id},[e("th",ye,[e("button",{type:"button",class:"btn btn-danger btn-sm me-3",onClick:At=>F(t)},[h(l).productChangeToCart==t.id?(u(),_("i",xe)):x("",!0),f(" 刪除 ")],8,Te)]),e("th",Ce,a(P+1),1),e("th",Ve,a(t.product.title),1),e("th",ke,a(t.qty),1),e("th",$e,a(t.product.price),1),e("th",Ee,a(t.total),1)],8,ge))),128))]),e("tfoot",null,[e("tr",null,[Pe,we,e("td",Ae,a(g.value.total),1)]),g.value.total!==g.value.final_total?(u(),_("tr",Ie,[Me,Ue,e("td",Se,a(g.value.final_total),1)])):x("",!0)])])])]),e("div",He,[e("div",Oe,[Le,A(e("input",{type:"text",class:"form-control rounded-0",id:"basic-url","aria-describedby":"basic-addon3","onUpdate:modelValue":s[1]||(s[1]=t=>y.value=t)},null,512),[[D,y.value]]),e("button",{type:"button",class:"btn btn-success rounded-0 rounded-end text-nowrap",onClick:B},"送出")])]),e("div",De,[p(R,{ref_key:"form_payOrder",ref:H,class:"col-md-6",onSubmit:j},{default:K(()=>[e("div",qe,[Be,p(v,{type:"email",class:"form-control",name:"email",id:"useremail",modelValue:c.value.user.email,"onUpdate:modelValue":s[2]||(s[2]=t=>c.value.user.email=t),placeholder:"請輸入 Email",rules:"required|email"},null,8,["modelValue"]),p(V,{name:"email",class:"text-danger"})]),e("div",Fe,[je,p(v,{type:"text",class:"form-control",name:"姓名",id:"username",modelValue:c.value.user.name,"onUpdate:modelValue":s[3]||(s[3]=t=>c.value.user.name=t),placeholder:"輸入姓名",rules:"required"},null,8,["modelValue"]),p(V,{name:"姓名",class:"text-danger"})]),e("div",Re,[Ne,p(v,{type:"tel",class:"form-control",name:"電話",id:"usertel",modelValue:c.value.user.tel,"onUpdate:modelValue":s[4]||(s[4]=t=>c.value.user.tel=t),placeholder:"請輸入電話",rules:{regex:/^[0-9]+$/,required:!0,min:10}},null,8,["modelValue"]),p(V,{name:"電話",class:"text-danger"})]),e("div",ze,[Ge,p(v,{type:"text",class:"form-control",name:"地址",id:"useraddress",modelValue:c.value.user.address,"onUpdate:modelValue":s[5]||(s[5]=t=>c.value.user.address=t),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue"]),p(V,{name:"地址",class:"text-danger"})]),e("div",Je,[Ke,A(e("textarea",{name:"",id:"comment",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[6]||(s[6]=t=>c.value.message=t)},null,512),[[D,c.value.message]])]),Qe]),_:1},512)])])]),e("div",{ref_key:"modalEle_product",ref:S,class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",We,[e("div",Xe,[e("div",Ye,[e("h5",Ze,[e("span",null,a(d.value.title),1)]),et]),e("div",tt,[e("div",st,[e("div",ot,[e("img",{src:d.value.imageUrl,class:"img-fluid",alt:""},null,8,at)]),e("div",lt,[nt,f(" "+a(d.value.description),1)]),dt,e("div",ct,[it,f(" "+a(d.value.content),1)]),rt,e("div",ut,[_t,e("span",pt,a(o.$currency.currencyUSD(d.value.origin_price)),1)]),e("div",mt,[ht,e("span",vt,a(o.$currency.currencyUSD(d.value.price)),1)]),e("div",ft,[e("div",bt,[e("div",gt,[yt,A(e("select",{id:"select-num",class:"form-select","aria-label":"Default select example","onUpdate:modelValue":s[7]||(s[7]=t=>C.value=t)},[Tt,(u(),_($,null,w(10,t=>e("option",{value:t,key:t},a(t)+" "+a(d.value.unit),9,xt)),64))],512),[[Q,C.value,void 0,{number:!0}]])])])]),e("div",Ct,[Vt,e("div",kt,[e("div",$t,[Et,f(" "+a(o.$currency.currencyUSD(d.value.price*C.value)),1)]),e("button",{id:"productModal_btn",type:"button",class:"btn btn-primary",onClick:s[8]||(s[8]=t=>L(d.value.id,C.value))},[h(l).productChangeToCart==d.value.id?(u(),_("i",Pt)):x("",!0),f(" 加到購物車 ")])])])])])])])],512)],64)}}};export{Ot as default};
